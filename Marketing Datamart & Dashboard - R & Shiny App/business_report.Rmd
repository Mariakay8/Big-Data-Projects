---
output:
  html_document: default
  pdf_document: default
---
---
title:  " BWIN DATAMART REPORT"
output: html_document



```{r include=FALSE}
library(markdown)
library(knitr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(tidyverse)
if(!require("shiny")) install.packages("shiny"); library("shiny")
if(!require("shinydashboard")) install.packages("shinydashboard"); library("shinydashboard")
if(!require("ggplot2")) install.packages("ggplot2"); library("ggplot2")
if(!require("dplyr")) install.packages("dplyr"); library("dplyr")
if(!require("scales")) install.packages("scales"); library("scales")
if(!require("tidyverse")) install.packages("tidyverse"); library("tidyverse")
if(!require("maps")) install.packages("maps"); library("maps")
```
```{r datainclude = FALSE , echo= FALSE}
Datamart<-read.csv("C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\Datamart - Final.csv")


```
\newpage

## Introduction 
Bwin is a multinational online sports betting and gaming company that was founded in 1997. It is headquartered in Gibraltar and operates in numerous countries around the world, including Europe, South America, and Asia. Bwin offers a wide range of betting options for sports such as football, basketball, tennis, and more, as well as casino games and online poker.
For this project, our goal is to create marketing insights for Bwin company. For this we used three data information from the companies data history which are:
* Demographics data : Contains data about user such as Gender, Language, Country, Applications and dates of First activities for several activities.
* UserDailyAggreagation : Contains Betting information such as Bets, Stakes and Winnings for everyday between February 2005 to 30 September 2005, for every user and betting type.
* PokerChipConversions : Contains poker chip transactions such as Transaction type (buy,sell), Transaction Date, and Amount.

## Data Preparation
* Fixed date format in demoghraphics and Aggregations datasets.
* Filtered users data in demoghraphics dataset to all users who were registered between Feb 1,2005 and Feb 27,2005.
* Dropped all NA values in Gender and FirstAct variables.
* Removed duplicated UserIDS in Demographics table.
* Created a new variable called Time_Interval which calculates the time between first pay and first activity.
* Replaced all negative values in aggregations by 0s.
* Extracted Month and Days from the Date column.
* Created Marketing metrics such as :
  + Total_Bets, Total_Stakes, Avg_Stakes, Min_Stakes, Total_winnings,  AVG_Winnings, Min_Winnings, Max_Winnings, Profit_User, Return_User, Profit_bwin, Nbr_Products, Total_Products, Diversified, First_Date, Last_Date, Active_Days. 
* Used the Extracted Month and Days with some of the Created metrics to pivot and create aggregations data for everyday of the week.
* Splited Date and Time From Conversions date column.
* Created new variables TransType to specify the Transaction Type (Buy, Sell)


## Demographics segmnetaion of customers 

### 1)Users distibution - applications

* BETANDWIN.DE is most preferred website to register for bwin follwed by BETANDWIN.com
  51% of bwin users are coming from BETANDWIN.DE.and BETANDWIN.com contributes for 31% of bwin users

```{r countries, echo = FALSE, message = FALSE, warning = FALSE ,out.width ='1000px',out.height='500px' }

    
  ColumnApplicationData <- Datamart %>% group_by(Application_Description) %>% summarize(nUserApplication=n()) %>% mutate(Application_Description = fct_reorder(Application_Description, nUserApplication))
  
    
graph1 <- ggplot(ColumnApplicationData, aes(x=nUserApplication, y=Application_Description)) + 
      geom_bar(fill='deepskyblue', stat='identity') +
      geom_text(aes(label = format(nUserApplication, big.mark = ",")), hjust=-0.2, colour = "black", size = 5) +
      xlim(NA, 25000) +                                       
      theme_void() +
      theme(axis.text.y = element_text(size = 14, hjust = 1), plot.margin = margin(rep(15, 4)))
graph1

```

### 2)Users distributtion - language
* Bwin has more customers from GERMAN. 
* 61% ogf bwin users speaks German language and and rest of the speakers are distributed over other counties 

```{r Languages, echo = FALSE, message = TRUE, warning = FALSE ,out.width ='1000px',out.height='500px' }

    ColumnData <- Datamart %>% group_by(Language_Description) %>% summarize(nUserLanguage=n()) %>% mutate(Language_Description = fct_reorder(Language_Description, nUserLanguage))
    
    
    graph2<-ggplot(ColumnData, aes(x=nUserLanguage, y=Language_Description)) + 
      geom_bar(fill='deepskyblue', stat='identity') +
      geom_text(aes(label = format(nUserLanguage, big.mark = ",")), hjust=-0.2, colour = "black", size = 5) +
      xlim(NA, 30000) +                                       
      theme_void() +
      theme(axis.text.y = element_text(size = 14, hjust = 1), plot.margin = margin(rep(15, 4)))
    graph2
```

### Users distribution - Gender 

* 92% of bwin users are male 

```{r Applications, echo = FALSE, message = FALSE, warning = FALSE ,out.width ='500px',out.height='300px' }
PieGenderData <- Datamart %>% group_by(Gender_Description) %>% summarize(nUserGender=n()) %>% mutate(Gender_Description = fct_reorder(Gender_Description, nUserGender), PercentGender = nUserGender / sum(nUserGender))
     
  GenderPlot <- ggplot(PieGenderData, aes(x="", y = PercentGender, fill=Gender_Description)) + 
      geom_bar(stat = "identity") +
      coord_polar(theta = "y", start = 0) +
      theme_void() +
      labs(fill = "") +                              
      scale_fill_manual(values=c("lightgrey", "deepskyblue")) +
      geom_text(aes(label = paste0(round(PercentGender*100), "%" )), position = position_stack(vjust = 0.5), size=5) +
      theme(legend.title = element_text(size = 18), legend.text = element_text(size = 14))
      GenderPlot
```

### Users distribution - Loyalty

*  Interestingly  half of bwin customers have lower average LOR ,
   these customers are not participated in any games since more than around 40days

```{r Gender, echo = FALSE, message = FALSE, warning = FALSE ,out.width ='500px',out.height='300px' }

PieLoyaltyData <- Datamart %>% filter(!is.na(Loyalty)) %>% group_by(Loyalty) %>% summarize(nUserLoyalty=n()) %>% mutate(Loyalty = fct_reorder(Loyalty, nUserLoyalty), PercentLoyalty = nUserLoyalty / sum(nUserLoyalty))
    
  loyal<-ggplot(PieLoyaltyData, aes(x="", y = PercentLoyalty, fill=Loyalty)) + 
     geom_bar(stat = "identity") +
     coord_polar(theta = "y", start = 0) +
     theme_void() +
      labs(fill = "") +
     scale_fill_manual(values=c("lightgrey", "deepskyblue")) +
     geom_text(aes(label = paste0(round(PercentLoyalty*100), "%" )), position = position_stack(vjust = 0.5), size=5) +
      theme(legend.title = element_text(size = 18), legend.text = element_text(size = 14))
   loyal

```

### User Distribution - Diverse in Products

* 67% of users are interested in multiple products of bwin and rest are only played one sports.

```{r aggreagation, echo = FALSE, message = FALSE, warning = FALSE ,out.width ='500px',out.height='300px' }
PieDiversityData<-Datamart %>% group_by(Diversified) %>% summarize(nUserDiversified=n()) %>% mutate(Diversified = ifelse(Diversified == 1, 'Play Multiple Games', 'Play Only 1 Game'), PercentDiversified = nUserDiversified / sum(nUserDiversified))
     
    
    diversity<-ggplot(PieDiversityData, aes(x="", y = PercentDiversified, fill=Diversified)) + 
      geom_bar(stat = "identity") +
      coord_polar(theta = "y", start = 0) +
      theme_void() +
      labs(fill = "") +
      scale_fill_manual(values=c("deepskyblue", "lightgrey")) +
      geom_text(aes(label = paste0(round(PercentDiversified*100), "%" )), position = position_stack(vjust = 0.5), size=5) +
      theme(legend.title = element_text(size = 18), legend.text = element_text(size = 14))
      diversity
  
```

### users Distribution - RFM score

* by giving more weightge to monetory and frequency followed by Recency ,

* 88% customers are below avg_score , companies most profit is generated from  just 11% of it customers.

```{r RFM, echo = FALSE, message = FALSE, warning = FALSE ,out.width ='500px',out.height='300px' }
PieRFMData <- Datamart %>% filter(!is.na(RFM_Score)) %>% mutate(Customer_Type = ifelse(RFM_Score <= mean(RFM_Score, na.rm=T),'Low', ifelse(RFM_Score <= 300 ,'Mid',"High"))) %>%
      group_by(Customer_Type) %>%
      summarize(percentage=n()/nrow(Datamart))
     
    
    RFM<-ggplot(PieRFMData, aes(x="", y = percentage, fill=Customer_Type)) + 
      geom_bar(stat = "identity") +
      coord_polar(theta = "y", start = 0) +
      theme_void() +
      labs(fill = "") +
      scale_fill_manual(labels=c("High", "Mid", "Low"), values=c("deepskyblue", "grey", "lightgrey")) +
      geom_text(aes(label = paste0(round(percentage*100), "%" )), position = position_stack(vjust = 0.5), size=5) +
      theme(legend.title = element_text(size = 18), legend.text = element_text(size = 14))
      RFM
```
 
### Business conclusions - demographics segmentation

* Bwin has most numbers coming from Germany  and  has negligible numbers of customers from  countries like , dutch, russay ..etc .  people used  mostly BETANDWIN.DE  to register to bwin and followed by  BETANDWIN.com.	 these 2 websites contributes around  82% user registration and rest is distributed among different websites .
*  bwin has 67% of customers who are participated in different games where as rest of customers are mainly involved in only one sports.
*  more than 80% of it customers has low RFM score , who are investing on stakes and contribute less to profit of the company.
* 50% of its customers are not loyal who has  very low LOR  than the avg (around 40days) 
* 88% customers are below avg_score , companies most profit is generaed form  just 11% of it customers       
  
```{r poker, echo = FALSE, message = FALSE, warning = FALSE ,out.width ='440px',out.height='350px' }

pokerbuyproduct<-Datamart%>% 
    select(UserID,AVG_TransAmount_Buy_Tuesday,AVG_TransAmount_Buy_Sunday,
           AVG_TransAmount_Buy_Monday,AVG_TransAmount_Buy_Thursday,
           AVG_TransAmount_Buy_Wednesday,AVG_TransAmount_Buy_Friday,
           AVG_TransAmount_Buy_Saturday)%>%
    pivot_longer(cols=-UserID,
                 names_to="weekday", values_to=c("avg_buy_trans"))%>%
    mutate(weekday=recode(weekday,
                          AVG_TransAmount_Buy_Tuesday="Tue",
                          AVG_TransAmount_Buy_Sunday ="sun",
                          AVG_TransAmount_Buy_Wednesday ="wed",
                          AVG_TransAmount_Buy_Friday="fri",
                          AVG_TransAmount_Buy_Monday="mon",
                          AVG_TransAmount_Buy_Thursday="thu",
                          AVG_TransAmount_Buy_Saturday ="sat" ))
  
  pokerbuyproductgrp<-pokerbuyproduct%>%group_by(weekday)%>%
    summarise(avg_buy_trans=mean(avg_buy_trans))
  
  #poker visualization average transaction amount-weekday-sell
  pokersellproduct<-Datamart%>% 
    select(UserID,AVG_TransAmount_Sell_Tuesday,AVG_TransAmount_Sell_Sunday,
           AVG_TransAmount_Sell_Monday,AVG_TransAmount_Sell_Thursday,
           AVG_TransAmount_Sell_Wednesday,AVG_TransAmount_Sell_Friday,
           AVG_TransAmount_Sell_Saturday)%>%
    pivot_longer(cols=-UserID,
                 names_to="weekday", values_to=c("avg_sell_trans"))%>%
    mutate(weekday=recode(weekday,
                          AVG_TransAmount_Sell_Tuesday="Tue",
                          AVG_TransAmount_Sell_Sunday ="sun",
                          AVG_TransAmount_Sell_Wednesday ="wed",
                          AVG_TransAmount_Sell_Friday="fri",
                          AVG_TransAmount_Sell_Monday="mon",
                          AVG_TransAmount_Sell_Thursday="thu",
                          AVG_TransAmount_Sell_Saturday ="sat" ))
  
  pokersellproductgrp<-pokersellproduct%>%group_by(weekday)%>%
    summarise(avg_sell_trans=mean(avg_sell_trans))
  
  
  pokerProductData <- merge(pokerbuyproductgrp, pokersellproductgrp, by="weekday", all.x=TRUE, all.y=TRUE) 
  pokerProductData
  
```

##  User aggregation activities 

### 1) stakes on different sports 

* casino -chart well is most prefereed by customer follwed by sports book live and fixeed action
* Users doesn't show any interest in supertoo games and also games bwin and games vs are very less attractive to customers.

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\stakes.PNG) 

### 2) stakes by weekdays 
* users invested more stakes on weekends saturday follwed by sunday , where as monday is the lowest with 15 millon euro

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\stakesweekday.PNG) 

### 2) winnings of users 

*  most of users winnings are generated from casiono chartwell , spoerts-live and fixed games 

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\winnings.PNG) 

### 2) winninng trend -weekday
*  winning remains high on weekends and lowest on monday

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\winningsweekday.PNG) 

## business conclusions stakes and winnings

* Users invested more on casino char well , sports live and fixed odds , where as 	
  Super too ,games vs  received negligible stakes compared to others.
* Winnings  od users from different sports also follow the same trend as stakes invested on different sports , these are positively corelated
* Users invested more stakes on weekends rather than weekdays , whereas Monday remains very lowest through the time period and Sunday remains highest



## poker chip activities

## poker chip activities - buy 

### 1)  avg transaction amount trend - Buy -weekday

* people bought more poke chips on fridays follwed by saturday and sunday
while sunday being least other tow days seems to ahve flat rate

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\avgbuytrend.PNG) 

### 2) total transaction amount - Buy-month

* august has seen highest business for buyinf pokerchips , where as october is least one.

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\buy-amount-bar.PNG)

### 3) number of transactions  - Buy-weekday

*  avg number of trnsactions for buying pokerchips is very high on friday and sunday, where saturday is lowest.

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\avgbuytrend-number.PNG) 

### 4) number of transactions  - Buy-month

* toal number of trnasactons for buying  poker chips is high on august , and very low on october..

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\buy-number-bar.PNG)

## poker chip activities - sell

### 1)  avg transaction amount trend - sell- weekday

#   avg transaction amount trend - sell -weekday

* poker chips sales are high on friday and  weekends

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\avgsalestrend.PNG) 

##   avg transaction amount trend - sell - month

* august has seen highest business for saling  pokerchips , where as october is least one.

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\sell-amount-bar.PNG) 

### business conclusion -poker 
* Poker buying activities can be seen more on Sunday  and Friday , Saturday being moderately okay , other days it remains flat , sales trend  is positively   corelated to buying trends
* Bwin  has experienced more poker business on august and very least on October , where as in months it does perform moderately okay. 


## Profit analysis of bwin
### 1)  profit by sports

* sports fixed and live are generating more profit to company , where has we see no profit/negliglble profit from supertoo.

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\profitgame.PNG)

### 2)  profit by customers

* sports fixed and live are generating more profit to company , where has we see no profit/negliglble profit from supertoo.

![](C:\\Users\\sm\\Desktop\\MARIA\\final dashboard\\profitcustomer.PNG)

### business conclusion -profit 
* Sports booked fixed and live  and casino chartwell  together contributes  90% of its profit , 
 Particularly sports fixed and live contributes 77% of total profit. games bwin, supertoo contributes noting on profit side 
 
* 70% of bwin profit is coming from just  top 11 % of its customers who is invested more on stakes 







